<div class="card">
  <div class="card-header">
    <h2>Feature Flags</h2>
    <div>
      <span class="badge badge-info"><%= @features.size %> features</span>
    </div>
  </div>

  <!-- Filtering UI -->
  <div style="padding: 16px; border-bottom: 1px solid #e0e0e0; background: #f9f9f9;">
    <%= form_with url: magick_admin_ui.features_path, method: :get, local: true, style: "display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;" do |f| %>
      <div style="flex: 1; min-width: 200px;">
        <label for="search" style="display: block; margin-bottom: 4px; font-weight: 500;">Search</label>
        <%= text_field_tag :search, params[:search], placeholder: "Search by name or description...", class: 'form-control', style: "width: 100%;" %>
      </div>
      <div style="flex: 0 0 180px;">
        <label for="group" style="display: block; margin-bottom: 4px; font-weight: 500;">Group</label>
        <%= select_tag :group, options_for_select([['All Groups', '']] + @available_groups.map { |g| [g, g] }, params[:group]), class: 'form-control', style: "width: 100%;" %>
      </div>
      <div style="flex: 0 0 auto;">
        <%= submit_tag 'Filter', class: 'btn btn-primary btn-sm', style: "height: 38px;" %>
        <% if params[:search].present? || params[:group].present? %>
          <%= link_to 'Clear', magick_admin_ui.features_path, class: 'btn btn-secondary btn-sm', style: "height: 38px;" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @features.empty? %>
    <div class="empty-state">
      <h3>No features found</h3>
      <p>Register features in your application to see them here.</p>
    </div>
  <% else %>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Group</th>
          <th>Type</th>
          <th>Status</th>
          <th>Value</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @features.each do |feature| %>
          <tr>
            <td data-label="Name">
              <strong><%= feature.display_name || feature.name %></strong>
              <br>
              <small style="color: #999;"><%= feature.name %></small>
            </td>
            <td data-label="Group">
              <% if feature.group.present? %>
                <span class="badge badge-info"><%= feature.group %></span>
              <% else %>
                <em style="color: #999;">â€”</em>
              <% end %>
            </td>
            <td data-label="Type">
              <span class="badge badge-info">
                <%= feature.type.to_s.capitalize %>
              </span>
            </td>
            <td data-label="Status">
              <% case feature.status.to_sym %>
              <% when :active %>
                <span class="badge badge-success">Active</span>
              <% when :deprecated %>
                <span class="badge badge-warning">Deprecated</span>
              <% when :inactive %>
                <span class="badge badge-danger">Inactive</span>
              <% else %>
                <span class="badge"><%= feature.status.to_s.capitalize %></span>
              <% end %>
            </td>
            <td data-label="Value">
              <% if feature.type == :boolean %>
                <% targeting = feature.instance_variable_get(:@targeting) || {} %>
                <% if targeting.any? %>
                  <span class="badge badge-warning">Partially Enabled</span>
                <% elsif feature.enabled? %>
                  <span class="badge badge-success">Enabled</span>
                <% else %>
                  <span class="badge badge-danger">Disabled</span>
                <% end %>
              <% else %>
                <code><%= feature.get_value.inspect %></code>
              <% end %>
            </td>
            <td data-label="Description">
              <%= feature.description || '<em>No description</em>'.html_safe %>
            </td>
            <td data-label="Actions">
              <div class="btn-group">
                <a href="<%= magick_admin_ui.feature_path(feature.name) %>" class="btn btn-primary btn-sm">View</a>
                <a href="<%= magick_admin_ui.edit_feature_path(feature.name) %>" class="btn btn-secondary btn-sm">Edit</a>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</div>
